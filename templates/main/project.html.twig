{% extends 'main/parent.html.twig' %}

{% block stylesheets %}
    <link href="{{ asset('web/styles/profile.css') }}" rel="stylesheet" type="text/css"/>
    <link href="{{ asset('web/styles/project-edit.css') }}" rel="stylesheet" type="text/css"/>
    <link href="{{ asset('web/styles/style.css') }}" rel="stylesheet" type="text/css"/>
    <script src="{{ asset('web/scripts/jquery-3.4.1.min.js') }}"></script>
{% endblock %}



{% block body %}



    <div id="profile">
        <div class="profile-left">
            <img id="profile-picture"
                 src="data:image/jpeg;base64,{{ photo_data_provider.getPhotoByProjectTitle(project.title) }}"
                 width="230" height="280">
        </div>

        <div class="profile-right">
            <p id="name-profile">{{ project.title }}
                {% if isAuthor %}
                    <button id="edit-mode" class="navico message-ico"><i class="fa fa-pencil"></i></button> {# edycja #}
                {% endif %}
            </p>
            
            
             {% if isAuthor %}
                     <div id="modal-edit" class="modal" style="display: hidden;">
                <div class="modal-content">
            <span class="close"></span>
                {#       form         #}
                    
                     <div class="edit-profile">
            
            <div class="edit-container">
                <div id="up">
                    <div id="photo">


                        <br>

                        <label for="image">
                            <input type="file" name="image" id="image" accept="image/jpeg, image/png"
                                   class="fileToUpload" style="display:none;"/>
                            <img id="photo-edit" src="data:image/jpeg;base64,{{ photo_data_provider.getPhotoByProjectTitle(project.title) }}" width="120"
                                 height="120">
                        </label>

                        <br><br><br>


                    </div>
                    
                    <div class="name_div">
                        <input type="text" class="name" placeholder="Tytuł" name="title" maxlength="50" value="{{ project.title }}"/>
                    </div>
                </div>
                <div class="info" style="text-align: left; margin-left:1%; margin-top: 1%; margin-bottom:1%;">
                    <p class="opis">Opis:</p><br>
                    <textarea name="text" class="bio" rows="10" cols="25">{{ project.description }}</textarea>
                    <input type="hidden" class="bio" placeholder="Opis" name="info" maxlength="250"/><br>
                    
                    <br>
                </div>
                
                {# powinny sie chyba wczytywac jakie już zostały dodane cnie? :[ #}
                <div id="tech-forms" class="forms">
                    <input type="text" class="bio tech" id="tech" placeholder="Technologie" maxlength="50"
                           name="technologies[]" list="TechList">
                    <datalist id="TechList">

                    </datalist>
                    <button type="button" id="button-moret" class="button-moret btad">+</button>
                    <br>
                </div>

                
                <div id="Technologies"></div>


            </div>
        
                    
                    <br>
                    <div class="buttons">
                    <button id="cancel-edit" class="button">Anuluj</button>
                    <input type="submit" id="send-btn" class="button" value="Zapisz">
        </div>
                        </div>
                    </div>
                            </div>
                {% endif %}
            
            

            <p class="infos">TECHNOLOGIE</p>
            {% for technology in project.technology %}
                {% if not loop.last %}
                    {{ technology.name }},
                {% else %}
                    {{ technology.name }}
                {% endif %}
            {% endfor %}
            <hr>


            <p class="infos">CZŁONKOWIE</p>
            {% for user in project.user %}
                {% if not loop.last %}
                    {{ user.firstname }} ({{ user.username }}) {{ user.lastname }},
                {% else %}
                    {{ user.firstname }} ({{ user.username }}) {{ user.lastname }}
                {% endif %}
            {% endfor %}
            <hr>


            <p>{{ project.description }}</p>
        </div>
    </div>
    {% if not isMember %}
        <div id="mess">
            <button id="message" class="navico message-ico"><i class="fa fa-envelope"></i></button> {# wyslij wiadomosc #}
            
            <div id="modal-message" class="modal">
                <div class="modal-content">
            <span class="close"></span>
                <p>Napisz wiadomość do <a href="">Autor</a></p>
                    <div class="photo-textarea">
       <form>
                    <textarea id="mssgtxt"name="text" class="form-control" rows="5" cols="25"></textarea>

                        <input type="hidden" name="username" value="">
                    </div>
                    <div class="buttons">
                    <button class="cancel-btn button">Anuluj</button>
                    <input type="submit" id="send-btn" class="button" value="Wyślij">
        </form>
                        </div>
                    </div>
                            </div>

            <button id="add-me" class="navico message-ico"><i class="fa fa-user-plus"></i></button> {# popros o dodanie #}

            <div id="modal-add" class="modal">
                <div class="modal-content">
            
                <p>Czy chcesz wysłać prośbę o dołączenie do projektu <a>{{ project.title }}</a>?</p>
                    
                    <div class="buttons" style="height: 40px; margin-top: 20px;">
                    <button class="cancel-btn button">Anuluj</button>
                    <input type="submit" id="send-btn" class="button" value="Wyślij prośbę">
        
                        </div>
                    
                    </div>
                            </div>
            
        </div>
    {% endif %}
    {% if isMember %}
        <div class="form-post">
            <img id="post-avatar" src="data:image/jpeg;base64,{{ photo_data_provider.getCurrentUserPhotoData() }}"
                 width="70" height="70">
            <form action="{{ path('create_project_post') }}" enctype="multipart/form-data" method="post">

                <div class="photo-textarea">
                    <textarea name="text" class="form-control" rows="5" cols="25"></textarea>

                    <input type="hidden" name="username" value={{ app.user.username }}>

                    <button style="display:none;" id="file-cancel"></button>
                    <label>
                        <input type="file" id="add-image" accept="image/jpeg, image/png" class="fileToUpload"
                               name="photo" style="display:none;"/>
                        <span><i class="fa fa-image"></i></span>
                    </label>

                    <input type="hidden" name="projectId" value={{ project.projectId }}>
                    <input type="submit" id="button-rem" class="button-post" value="Opublikuj"></div>
                <br>

            </form>
        </div>

        {% for post in posts %}
            <div class="comment">
                <a href="{{ path('user_profile', {'username': post.user.username}) }}"><img id="comment-avatar" src="data:image/jpeg;base64,{{ photo_data_provider.getPhotoByUsername(post.user.username) }}"
                                            width="70" height="70"></a>

                <p class="project-title"
                   href="{{ path('user_profile', {'username': post.user.username}) }} ">{{ post.user.firstname }} {{ post.user.lastname }}</p>
                ✽ {{ post.timestamp.format('Y-m-d H:i:s') }}
                 <p class="comment-content">{{ post.text }}</p>
            {% if post.photo %}
                <div class="comment-image"><img image-zoom
                        src="data:image/jpeg;base64,{{ photo_data_provider.getPhotoByPostId(post.postId) }}" width="250"
                        ></div>
            {% endif %}
        </div>
        {% endfor %}
    {% endif %}

    <script>
        $(document).ready(function () {

            ////popup add-me
            $("#add-me").on("click", function () {
                event.preventDefault();
                $('#modal-add').show();
            });
            
                ////popup message
            $("#message").on("click", function () {
                event.preventDefault();
                $('#modal-message').show();
            });
            //close modals
            $(".cancel-btn").on("click", function () {
                event.preventDefault();
                $('#mssgtxt').val("");
                $('#modal-add').hide();
                $('#modal-message').hide();
            });
            
            
            //////popup edit mode
                $("#edit-mode").on("click", function () {
                event.preventDefault();
                $('#modal-edit').show();
            });
            //cancel edit mode
            $("#cancel-edit").on("click", function () {
                event.preventDefault();
                $('#modal-edit').hide();
            });
            
            //////////////photo preview
            function readURL(input) {

                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    var filename = (input.files[0].name);

                    reader.onload = function (e) {
                        $('#file-cancel').html("x " + filename);
                        $('#file-cancel').show();
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }

            $("#add-image").change(function () {
                readURL(this);
            });
            /////////////////

            $("#file-cancel").on("click", function () {
                event.preventDefault();
                $('#add-image').val("");
                $('#file-cancel').hide();
            });

              ///////photo preview comment
        
        $('img[image-zoom]').addClass('img-enlargable').click(function(){
    var src = $(this).attr('src');
    $('<div>').css({
        background: 'RGBA(0,0,0,.7) url('+src+') no-repeat center',
        backgroundSize: 'contain',
        width:'100%', height:'100%',
        position:'fixed',
        zIndex:'10000',
        top:'0', left:'0',
        cursor: 'zoom-out'
    }).click(function(){
        $(this).remove();
    }).appendTo('body');
});

        });
    </script>

 <script src="{{ asset('web/scripts/edit-project.js') }}"></script>

{% endblock %}